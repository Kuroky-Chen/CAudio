import PCMPlayer from"pcm-player";class CAudio{constructor(e){this.config=e;const{url:t,params:s,audioType:n,token:i,sampleRate:r,bufferSize:a,volume:o,flushTime:l,inputCodec:h,channels:u}=e;this.player=null,this.apiUrl=t||"",this.params=s||"",this.audioType=n||"wav",this.token=i||"",this.sampleRate=r||16e3,this.bufferSize=a||16e3,this.volume=o||1,this.flushTime=l||200,this.channels=u||1,this.inputCodec=h||"Int16",this.init()}play(){try{const e=new Headers;e.append("Authorization",this.token),e.append("Accept",`audio/${this.audioType}`);const t=this.controller.signal,s=[];fetch(this.apiUrl+"?"+this.params.toString(),{headers:e,signal:t}).then((e=>{const t=e.body.getReader();return new ReadableStream({start:e=>function s(){return t.read().then((({done:t,value:n})=>{if(!t)return e.enqueue(n),s();e.close()}))}()})})).then((e=>{const t=e.getReader();return new Response(new ReadableStream({start(e){const n=()=>t.read().then((({done:t,value:i})=>{if(t)return void e.close();const r=Array.from(i);return s.push(...r),n()}));return n()}}))})).catch((e=>{}))}catch(e){console.error(e)}}stop(){try{this.player.pause(),this.controller.abort()}catch(e){console.warn(e)}this.player=null,this.init()}init(){this.controller=new AbortController,this.audioBuffer=[],this.player=new PCMPlayer({inputCodec:this.inputCodec,channels:this.channels,sampleRate:this.sampleRate,flushTime:this.flushTime,onstatechange:(e,t,s)=>(console.log("type",e,t,s),{}),onended:(e,t)=>(console.log("end fire",e,t),{})}),this.player.volume(this.volume)}}export default CAudio;